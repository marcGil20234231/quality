import{b as U}from"./chunk-4AEBGA5V.js";import{J as p,M as h,Qb as n,R as u,g as c,k as s,ma as f,n as d,v as o}from"./chunk-C2RAPJWX.js";import{a as m,b as l}from"./chunk-2NFLSA4Y.js";var b=class a{constructor(e,t){this.http=e;this.platformId=t;if(n(this.platformId)){let r=localStorage.getItem("currentUser");r&&this.currentUserSubject.next(JSON.parse(r))}}apiUrl="http://localhost:3000";currentUserSubject=new c(null);currentUser$=this.currentUserSubject.asObservable();adminUsers=[{id:1,username:"admin1",email:"admin1@edu.ph",isAdmin:!0},{id:2,username:"admin2",email:"admin2@edu.ph",isAdmin:!0},{id:3,username:"admin3",email:"admin3@edu.ph",isAdmin:!0}];login(e,t){return this.http.get(`${this.apiUrl}/users?email=${e}`).pipe(d(r=>{let i=r[0];if(i&&i.password===t)return delete i.password,n(this.platformId)&&localStorage.setItem("currentUser",JSON.stringify(i)),this.currentUserSubject.next(i),i;throw new Error("Invalid credentials")}),o(r=>s(()=>r)))}register(e){if(e.isAdmin&&this.adminUsers.length>=3)return s(()=>new Error("Maximum admin users reached (3)"));let t=l(m({},e),{createdAt:new Date,id:Math.floor(Math.random()*1e3)});return this.http.post(`${this.apiUrl}/users`,t).pipe(p(r=>{r.isAdmin&&this.adminUsers.push({id:r.id,username:r.username,email:r.email,isAdmin:!0})}),o(r=>s(()=>r)))}logout(){n(this.platformId)&&localStorage.removeItem("currentUser"),this.currentUserSubject.next(null)}getCurrentUser(){return this.currentUserSubject.value}isLoggedIn(){return!!this.currentUserSubject.value}isAdmin(){let e=this.currentUserSubject.value;return!!e&&e.isAdmin}static \u0275fac=function(t){return new(t||a)(u(U),u(f))};static \u0275prov=h({token:a,factory:a.\u0275fac,providedIn:"root"})};export{b as a};
